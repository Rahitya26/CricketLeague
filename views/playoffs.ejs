<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playoffs - Epstein Cricket League</title>
  <link rel="stylesheet" href="/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    .playoff-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .playoff-match {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .match-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #1a3a1f;
    }
    
    .match-header h3 {
      margin: 0;
      color: #1a3a1f;
      font-weight: 700;
    }
    
    .match-status {
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .completed { background-color: #e8f5e9; color: #1a3a1f; }
    .pending { background-color: #fff3cd; color: #856404; }
    
    .match-teams {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .team-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-radius: 4px;
      background-color: #f8f9fa;
    }
    
    .winner {
      background-color: rgba(46, 204, 113, 0.2);
      border-left: 3px solid #2ecc71;
    }
    
    .match-result {
      margin-top: 15px;
      font-weight: 600;
      color: #1a3a1f;
      text-align: center;
    }
    
    .match-notes {
      margin-top: 10px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    .admin-controls {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px dashed #ccc;
    }
    
    /* Match type indicators */
    .qualifier1 { border-left: 4px solid #3498db; }
    .eliminator { border-left: 4px solid #e74c3c; }
    .qualifier2 { border-left: 4px solid #f39c12; }
    .final { border-left: 4px solid #2ecc71; }
    
    /* Bracket connectors */
    .bracket-arrow {
      position: absolute;
      right: -30px;
      width: 30px;
      height: 2px;
      background: #1a3a1f;
      top: 50%;
    }
    
    .bracket-arrow::after {
      content: '';
      position: absolute;
      right: 0;
      top: -4px;
      width: 0;
      height: 0;
      border-left: 8px solid #1a3a1f;
      border-top: 5px solid transparent;
      border-bottom: 5px solid transparent;
    }
    
    @media (max-width: 768px) {
      .bracket-arrow {
        display: none;
      }
      
      .playoff-container {
        gap: 15px;
      }
      
      .playoff-match {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-title">
      <img src="/logo.png" alt="ECL Logo" class="logo">
      <h1><a href="/">Epstein Cricket League - Playoffs</a></h1>
    </div>
    <nav>
      <a href="/" class="nav-link">Home</a>
      <% if (isAdmin) { %>
        <a href="/logout" class="nav-link">Logout</a>
      <% } else { %>
        <a href="/admin" class="nav-link">Admin Login</a>
      <% } %>
    </nav>
  </header>

  <main class="container">
    <div class="playoff-container">
      <!-- Qualifier 1 -->
      <% const qualifier1 = playoffMatches.find(m => m.match_type === 'Qualifier1') %>
      <div class="playoff-match qualifier1">
        <div class="match-header">
          <h3>Qualifier 1</h3>
          <span class="match-status <%= qualifier1?.winner ? 'completed' : 'pending' %>">
            <%= qualifier1?.winner ? 'Completed' : 'Pending' %>
          </span>
        </div>
        
        <% if (qualifier1) { %>
          <div class="match-teams">
            <div class="team-row <%= qualifier1.winner === qualifier1.team1 ? 'winner' : '' %>">
              <span><%= qualifier1.team1 %></span>
              <span><%= qualifier1.score_team1 || '–' %></span>
            </div>
            <div class="team-row <%= qualifier1.winner === qualifier1.team2 ? 'winner' : '' %>">
              <span><%= qualifier1.team2 %></span>
              <span><%= qualifier1.score_team2 || '–' %></span>
            </div>
          </div>
          
          <% if (qualifier1.winner) { %>
            <div class="match-result">Winner: <%= qualifier1.winner %></div>
          <% } %>
          
          <% if (qualifier1.notes) { %>
            <div class="match-notes"><%= qualifier1.notes %></div>
          <% } %>
          
          <% if (isAdmin) { %>
            <div class="admin-controls">
              <form action="/update-playoff-result" method="POST" class="form-block">
                <input type="hidden" name="matchId" value="<%= qualifier1.id %>">
                <div class="form-group">
                  <input type="text" name="score_team1" placeholder="Score <%= qualifier1.team1 %>" 
                         value="<%= qualifier1.score_team1 || '' %>" required>
                </div>
                <div class="form-group">
                  <input type="text" name="score_team2" placeholder="Score <%= qualifier1.team2 %>" 
                         value="<%= qualifier1.score_team2 || '' %>" required>
                </div>
                <div class="form-group">
                  <select name="winner" required>
                    <option value="">Select winner</option>
                    <option value="<%= qualifier1.team1 %>" <%= qualifier1.winner === qualifier1.team1 ? 'selected' : '' %>>
                      <%= qualifier1.team1 %>
                    </option>
                    <option value="<%= qualifier1.team2 %>" <%= qualifier1.winner === qualifier1.team2 ? 'selected' : '' %>>
                      <%= qualifier1.team2 %>
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <textarea name="notes" placeholder="Match notes"><%= qualifier1.notes || '' %></textarea>
                </div>
                <div class="form-actions">
                  <button type="submit" class="primary">Update</button>
                  <form action="/delete-playoff-match" method="POST" style="display: inline;">
                    <input type="hidden" name="id" value="<%= qualifier1.id %>">
                    <button type="submit" class="danger">Delete</button>
                  </form>
                </div>
              </form>
            </div>
          <% } %>
        <% } else { %>
          <p>No qualifier 1 match scheduled</p>
          <% if (isAdmin) { %>
            <div class="admin-controls">
              <form action="/add-playoff-match" method="POST">
                <input type="hidden" name="match_type" value="Qualifier1">
                <div class="form-group">
                  <select name="team1" required>
                    <option value="">Select Team 1</option>
                    <% teams.forEach(team => { %>
                      <option value="<%= team %>"><%= team %></option>
                    <% }); %>
                  </select>
                </div>
                <div class="form-group">
                  <select name="team2" required>
                    <option value="">Select Team 2</option>
                    <% teams.forEach(team => { %>
                      <option value="<%= team %>"><%= team %></option>
                    <% }); %>
                  </select>
                </div>
                <button type="submit" class="primary">Add Match</button>
              </form>
            </div>
          <% } %>
        <% } %>
        <div class="bracket-arrow"></div>
      </div>

      <!-- Eliminator -->
      <% const eliminator = playoffMatches.find(m => m.match_type === 'Eliminator') %>
      <div class="playoff-match eliminator">
        <div class="match-header">
          <h3>Eliminator</h3>
          <span class="match-status <%= eliminator?.winner ? 'completed' : 'pending' %>">
            <%= eliminator?.winner ? 'Completed' : 'Pending' %>
          </span>
        </div>
        
        <% if (eliminator) { %>
          <div class="match-teams">
            <div class="team-row <%= eliminator.winner === eliminator.team1 ? 'winner' : '' %>">
              <span><%= eliminator.team1 %></span>
              <span><%= eliminator.score_team1 || '–' %></span>
            </div>
            <div class="team-row <%= eliminator.winner === eliminator.team2 ? 'winner' : '' %>">
              <span><%= eliminator.team2 %></span>
              <span><%= eliminator.score_team2 || '–' %></span>
            </div>
          </div>
          
          <% if (eliminator.winner) { %>
            <div class="match-result">Winner: <%= eliminator.winner %></div>
          <% } %>
          
          <% if (eliminator.notes) { %>
            <div class="match-notes"><%= eliminator.notes %></div>
          <% } %>
          
          <% if (isAdmin) { %>
            <div class="admin-controls">
              <form action="/update-playoff-result" method="POST" class="form-block">
                <input type="hidden" name="matchId" value="<%= eliminator.id %>">
                <!-- Same form structure as Qualifier 1 -->
              </form>
            </div>
          <% } %>
        <% } else { %>
          <p>No eliminator match scheduled</p>
          <% if (isAdmin) { %>
            <div class="admin-controls">
              <form action="/add-playoff-match" method="POST">
                <input type="hidden" name="match_type" value="Eliminator">
                <!-- Same form structure as Qualifier 1 -->
              </form>
            </div>
          <% } %>
        <% } %>
        <div class="bracket-arrow"></div>
      </div>

      <!-- Qualifier 2 -->
      <% const qualifier2 = playoffMatches.find(m => m.match_type === 'Qualifier2') %>
      <div class="playoff-match qualifier2">
        <div class="match-header">
          <h3>Qualifier 2</h3>
          <span class="match-status <%= qualifier2?.winner ? 'completed' : 'pending' %>">
            <%= qualifier2?.winner ? 'Completed' : 'Pending' %>
          </span>
        </div>
        
        <% if (qualifier2) { %>
          <!-- Same content structure as Qualifier 1 -->
        <% } else { %>
          <p>No qualifier 2 match scheduled</p>
          <% if (isAdmin) { %>
            <div class="admin-controls">
              <form action="/add-playoff-match" method="POST">
                <input type="hidden" name="match_type" value="Qualifier2">
                <!-- Same form structure as Qualifier 1 -->
              </form>
            </div>
          <% } %>
        <% } %>
        <div class="bracket-arrow"></div>
      </div>

      <!-- Final -->
      <% const final = playoffMatches.find(m => m.match_type === 'Final') %>
      <div class="playoff-match final">
        <div class="match-header">
          <h3>Final</h3>
          <span class="match-status <%= final?.winner ? 'completed' : 'pending' %>">
            <%= final?.winner ? 'Completed' : 'Pending' %>
          </span>
        </div>
        
        <% if (final) { %>
          <!-- Same content structure as Qualifier 1 -->
          <% if (final.winner) { %>
            <div class="champion" style="margin-top: 15px; text-align: center;">
              <h3>🏆 Champions: <%= final.winner %> 🏆</h3>
            </div>
          <% } %>
        <% } else { %>
          <p>No final match scheduled</p>
          <% if (isAdmin) { %>
            <div class="admin-controls">
              <form action="/add-playoff-match" method="POST">
                <input type="hidden" name="match_type" value="Final">
                <!-- Same form structure as Qualifier 1 -->
              </form>
            </div>
          <% } %>
        <% } %>
      </div>
    </div>
  </main>
</body>
</html>
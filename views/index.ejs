<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Epstein Cricket League</title>
  <link rel="stylesheet" href="/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Navbar styles */
    header {
      background: #0F1C3F;
      color: white;
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .nav-link {
      color: white;
      font-weight: 600;
      text-decoration: none;
      margin-left: 2rem;
    }
    .nav-link:hover {
      text-decoration: underline;
    }

    /* Existing styles */
    .completed { opacity: 0.5; }
    .hidden { display: none; }
    .small-button {
      font-size: 0.8rem;
      padding: 2px 6px;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-title">
      <img src="/logo.png" alt="ECL Logo" class="logo">
      <h1>Epstein Cricket League</h1>
    </div>
    <nav>
      <% if (isAdmin) { %>
        <a href="/logout" class="nav-link">Logout</a>
      <% } else { %>
        <a href="/admin" class="nav-link">Admin Login</a>
      <% } %>
    </nav>
  </header>

  <main>
    <% if (isAdmin) { %>
      <section class="card">
        <h2>Add New Match</h2>
        <form action="/add-match" method="POST" class="form-inline">
          <select name="team1" required>
            <% for (let t in teams) { %>
              <option value="<%= t %>"><%= t %></option>
            <% } %>
          </select>
          <span>vs</span>
          <select name="team2" required>
            <% for (let t in teams) { %>
              <option value="<%= t %>"><%= t %></option>
            <% } %>
          </select>
          <button type="submit">Create</button>
        </form>
      </section>
    <% } %>

    <section class="card">
      <h2>Matches</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th><th>Team 1</th><th>Team 2</th>
            <th>Score 1</th><th>Score 2</th><th>Winner</th>
            <% if (isAdmin) { %><th>Actions</th><% } %>
          </tr>
        </thead>
        <tbody>
          <% 
            // Sort matches by ID in descending order (most recent first)
            matches.sort((a, b) => b.id - a.id);
            matches.forEach(m => { 
          %>
            <tr class="<%= m.winner ? 'completed' : '' %>">
              <td><%= m.id %></td>
              <td>
                <%= m.team1 %>
                <span class="captain">– <%= teams[m.team1] %></span>
              </td>
              <td>
                <%= m.team2 %>
                <span class="captain">– <%= teams[m.team2] %></span>
              </td>
              <td><%= m.score_team1 ?? '–' %></td>
              <td><%= m.score_team2 ?? '–' %></td>
              <td><%= m.winner ?? '–' %></td>

              <% if (isAdmin) { %>
                <td>
                  <div id="edit-form-<%= m.id %>" class="<%= m.winner ? 'hidden' : '' %>">
                    <form action="/update-winner" method="POST" class="form-block">
                      <input type="hidden" name="matchId" value="<%= m.id %>">
                      <input type="text" name="score_team1" placeholder="Score <%= m.team1 %>" required>
                      <input type="text" name="score_team2" placeholder="Score <%= m.team2 %>" required>
                      <select name="winner" required>
                        <option value="<%= m.team1 %>"><%= m.team1 %></option>
                        <option value="<%= m.team2 %>"><%= m.team2 %></option>
                      </select>
                      <button type="submit">Update</button>
                    </form>
                  </div>
                  <% if (m.winner) { %>
                    <button class="small-button" onclick="enableEdit('<%= m.id %>')">Confirm Update Scores</button>
                  <% } %>
                  <form action="/delete-match" method="POST" class="form-inline small">
                    <input type="hidden" name="id" value="<%= m.id %>">
                    <button type="submit" class="danger">Delete</button>
                  </form>
                </td>
              <% } %>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </section>

    <section class="card">
      <h2>Points Table</h2>
      <table>
        <thead><tr><th>Team</th><th>Points</th></tr></thead>
        <tbody>
          <% for (const [t, p] of Object.entries(points).sort((a, b) => b[1] - a[1])) { %>
            <tr>
              <td>
                <strong><%= t %></strong>
                <span class="captain">– <%= teams[t] %></span>
              </td>
              <td><%= p %></td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </section>
  </main>

  <script>
    function enableEdit(matchId) {
      const editForm = document.getElementById(`edit-form-${matchId}`);
      if (editForm) {
        editForm.classList.remove('hidden');
      }
    }
  </script>
</body>
</html>
